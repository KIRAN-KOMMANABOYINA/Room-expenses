<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Room Expense Manager</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #f8f9fa; }
        .tab-content { margin-top: 20px; }
    </style>
</head>
<body class="container mt-5">

    <h2 class="mb-4 text-center">üè† Room Expense Manager</h2>

    <!-- Tabs -->
    <ul class="nav nav-tabs" id="tabs">
        <li class="nav-item">
            <a class="nav-link" id="add-tab" onclick="showTab('add')">Add Expense</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="all-tab" onclick="showTab('all')">All Transactions</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="search-tab" onclick="showTab('search')">Search</a>
        </li>
    </ul>

    <!-- Add Expense -->
    <div id="add" class="tab-content">
        <form th:action="@{/add}" method="post" class="mt-3">
            <div class="row g-2">
                <div class="col-md-3">
                    <input type="text" name="productName" placeholder="Product Name" class="form-control" required>
                </div>
                <div class="col-md-2">
                    <input type="number" step="0.01" name="price" placeholder="Price" class="form-control" required>
                </div>
                <div class="col-md-3">
                    <input type="text" name="userName" placeholder="Who Paid?" class="form-control" required>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">Add</button>
                </div>
            </div>
        </form>
    </div>

    <!-- All Transactions -->
    <div id="all" class="tab-content" style="display:none;">
        <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Price (‚Çπ)</th>
                    <th>User</th>
                    <th>Date & Time</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="exp : ${expenses}">
                    <td th:text="${exp.productName}"></td>
                    <td th:text="${exp.price}"></td>
                    <td th:text="${exp.userName}"></td>
                    <td th:text="${exp.dateTime}"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Search -->
    <div id="search" class="tab-content" style="display:none;">
        <form th:action="@{/search}" method="post" class="mt-3">
            <div class="row g-2">
                <div class="col-md-2">
                    <input type="number" name="month" placeholder="Month (1-12)" class="form-control" required>
                </div>
                <div class="col-md-2">
                    <input type="number" name="year" placeholder="Year" class="form-control" required>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-success w-100">Search</button>
                </div>
            </div>
        </form>

        <div th:if="${searchResults != null}">
            <h4 class="mt-4">Results for [[${month}]] / [[${year}]]</h4>
            <table class="table table-bordered mt-2">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Price (‚Çπ)</th>
                        <th>User</th>
                        <th>Date & Time</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="exp : ${searchResults}">
                        <td th:text="${exp.productName}"></td>
                        <td th:text="${exp.price}"></td>
                        <td th:text="${exp.userName}"></td>
                        <td th:text="${exp.dateTime}"></td>
                    </tr>
                </tbody>
            </table>
            <h5 class="text-end mt-2">Total: ‚Çπ [[${total}]]</h5>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.getElementById(tabName).style.display = 'block';

            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // On reload, open correct tab from backend
        let activeTab = /*[[${activeTab}]]*/ 'add';
        showTab(activeTab);
    </script>

</body>
</html>
